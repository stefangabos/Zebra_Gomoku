(function(f){f.gomoku=function(A,B){var C={board_size:15,ai_first:null,endgame:null},m=this,e=[],c,u,v=!1,x=function(c,g){e[c]=g;f(u[c]).addClass("p"+Math.abs(g-m.s.ai_first))};(function(){m.s=f.extend({},C,B);m.board=A;c=m.s.board_size;var y=f('<table id="zebraGomoku">').on("click","td",function(){if(!v||e[u.index(this)])return!1;x(u.index(this),2);var a,q,h,b,r,d,n,p,g,f,t,k,l,w;v=!1;for(a=0;a<c*c;a++)if(1!=e[a]){e[a]||void 0!==k||(k=[a,0,0]);l=[0,0];for(q=0;4>q;q++){w=[0,0];for(h=0;h<(e[a]?1:5);h++){n=e[a]||void 0;p=[];for(b=0;7>b;b++)if(r=-5+h+b,!((0===q&&!1!==(d=a+c*r)&&a%c==d%c||1==q&&!1!==(d=a+r)&&Math.floor(d/c)==Math.floor(a/c)||2==q&&!1!==(d=a-c*r+r)&&(d>a&&d%c<a%c||d<a&&d%c>a%c||d==a)||3==q&&!1!==(d=a+c*r+r)&&(d<a&&d%c<a%c||d>a&&d%c>a%c)||d==a)&&0<=d&&d<c*c)||e[d]!=n&&(e[a]||e[d]&&void 0!==n)&&b&&6!=b)if(b&&6!=b)break;else p.push(void 0);else p.push(d),b&&6!=b&&void 0===n&&e[d]&&(n=e[d]);if(7==p.length&&void 0!==n){r=e[a]?!0:!1;e[a]=n;for(b=t=g=f=0;5>b;b++)e[p[b+1]]==n&&g++;for(b=p.indexOf(a)-1;0<=b;b--)if(e[p[b]]==n)f++;else{0===e[p[b]]&&t++;break}for(b=p.indexOf(a);b<p.length;b++)if(e[p[b]]==n)f++;else{0===e[p[b]]&&t++;break}b=[[0,1],[2,3],[4,12],[10,64],[256,256]][f>=g?Math.min(f,5)-1:g-1][f>=g?t?t-1:0:0];r?256<=b&&(b=1024):e[a]=0;b>w[n-1]&&(w[n-1]=b)}}for(h=0;2>h;h++)l[h]+=w[h]}q=l[0]+l[1];h=k[1]+k[2];(l[0]||l[1])&&(q>h||q==h&&l[0]>=k[1]&&l[0]!=k[1]&&l[1]!=k[2])&&(!e[a]||1024<=l[1])&&(k=[a,l[0],l[1]])}1024>k[2]&&x(k[0],1);(256<=k[1]||1024<=k[2])&&"function"==typeof m.s.endgame?m.s.endgame.apply(null,[1024>k[2]]):v=!0}),g,z;for(g=0;g<c*c;g++)e[g]=0,g%c||(z=f("<tr>").appendTo(y)),f("<td>").appendTo(z);y.appendTo(m.board);u=f("td",m.board);m.s.ai_first||null===m.s.ai_first&&1==Math.round(Math.random())?(m.s.ai_first=1,x(Math.floor(c/2)*(1+c),1)):m.s.ai_first=2;v=!0})()}})(jQuery);