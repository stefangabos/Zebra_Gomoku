(function(f){f.gomoku=function(A,B){var C={board_size:15,ai_first:null,endgame:null},l=this,e=[],b,u,v=!1,x=function(b,g){e[b]=g;f(u[b]).addClass("p"+Math.abs(g-l.s.ai_first))};(function(){l.s=f.extend({},C,B);l.board=A;b=l.s.board_size;var y=f('<table id="zebraGomoku">').on("click","td",function(){if(!v||e[u.index(this)])return!1;x(u.index(this),2);var a,q,p,c,r,d,m,n,g,f,t,h,k,w;v=!1;for(a=b*b;a--;)if(1!=e[a]){e[a]||void 0!==h||(h=[a,0,0]);k=[0,0];for(q=4;q--;){w=[0,0];for(p=e[a]?1:5;p--;){m=e[a]||void 0;n=[];for(c=7;c--;)if(r=-5+p+c,!((0===q&&!1!==(d=a+b*r)&&a%b==d%b||1==q&&!1!==(d=a+r)&&~~(d/b)==~~(a/b)||2==q&&!1!==(d=a-b*r+r)&&(d>a&&d%b<a%b||d<a&&d%b>a%b||d==a)||3==q&&!1!==(d=a+b*r+r)&&(d<a&&d%b<a%b||d>a&&d%b>a%b)||d==a)&&0<=d&&d<b*b)||e[d]!=m&&(e[a]||e[d]&&void 0!==m)&&c&&6!=c)if(c&&6!=c)break;else n.push(void 0);else n.push(d),c&&c^6&&void 0===m&&e[d]&&(m=e[d]);if(7==n.length&&void 0!==m){r=e[a]?!0:!1;e[a]=m;t=g=f=0;for(c=5;c--;)e[n[c+1]]==m&&g++;for(c=n.indexOf(a)-1;0<=c;c--)if(e[n[c]]==m)f++;else{0===e[n[c]]&&t++;break}for(c=n.indexOf(a);c<n.length;c++)if(e[n[c]]==m)f++;else{0===e[n[c]]&&t++;break}c=[[0,1],[2,3],[4,12],[10,64],[256,256]][f>=g?Math.min(f,5)-1:g-1][f>=g?t?t-1:0:0];r?256<=c&&(c=1024):e[a]=0;c>w[m-1]&&(w[m-1]=c)}}for(p=2;p--;)k[p]+=w[p]}q=k[0]+k[1];p=h[1]+h[2];(k[0]||k[1])&&(q>p||q==p&&k[0]>=h[1]&&k[0]^h[1]&&k[1]^h[2])&&(!e[a]||1024<=k[1])&&(h=[a,k[0],k[1]])}1024>h[2]&&x(h[0],1);(256<=h[1]||1024<=h[2])&&"function"==typeof l.s.endgame?l.s.endgame.apply(null,[1024>h[2]]):v=!0}),g,z;for(g=0;g<b*b;g++)e[g]=0,g%b||(z=f("<tr>").appendTo(y)),f("<td>").appendTo(z);y.appendTo(l.board);u=f("td",l.board);l.s.ai_first||null===l.s.ai_first&&Math.random()+.5|0?(l.s.ai_first=1,x(~~(b/2)*(1+b),1)):l.s.ai_first=2;v=!0})()}})(jQuery);