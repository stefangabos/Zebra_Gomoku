(function(f){f.gomoku=function(A,B){var C={board_size:15,ai_first:null,endgame:null},m=this,e=[],b,u,v=!1,x=function(b,g){e[b]=g;f(u[b]).addClass("p"+Math.abs(g-m.s.ai_first)).html(f("<div>").append(f("<span>")))};(function(){m.s=f.extend({},C,B);m.b=A;b=m.s.board_size;var y=f('<table id="zebraGomoku">').on("click","td",function(){if(!v||e[u.index(this)])return!1;x(u.index(this),2);var a,q,h,c,f,d,n,p,g,r,t,k,l,w;v=!1;for(a=0;a<b*b;a++)if(1!=e[a]){e[a]||void 0!==k||(k=[a,0,0]);l=[0,0];for(q=0;4>q;q++){w=[0,0];for(h=0;h<(e[a]?1:5);h++){n=e[a]||void 0;p=[];for(c=0;7>c;c++)if(f=-5+h+c,!((0===q&&!1!==(d=a+b*f)&&a%b==d%b||1==q&&!1!==(d=a+f)&&Math.floor(d/b)==Math.floor(a/b)||2==q&&!1!==(d=a-b*f+f)&&(d>a&&d%b<a%b||d<a&&d%b>a%b||d==a)||3==q&&!1!==(d=a+b*f+f)&&(d<a&&d%b<a%b||d>a&&d%b>a%b)||d==a)&&0<=d&&d<b*b)||e[d]!=n&&(e[a]||e[d]&&void 0!==n)&&c&&6!=c)if(c&&6!=c)break;else p.push(void 0);else p.push(d),c&&6!=c&&void 0===n&&e[d]&&(n=e[d]);if(7==p.length&&void 0!==n){f=e[a]?!0:!1;e[a]=n;for(c=t=g=r=0;5>c;c++)e[p[c+1]]==n&&g++;for(c=p.indexOf(a)-1;0<=c;c--)if(e[p[c]]==n)r++;else{0===e[p[c]]&&t++;break}for(c=p.indexOf(a);c<p.length;c++)if(e[p[c]]==n)r++;else{0===e[p[c]]&&t++;break}c=[[0,1],[2,3],[4,12],[10,64],[256,256]][r>=g?Math.min(r,5)-1:g-1][r>=g?t?t-1:0:0];f?256<=c&&(c=1024):e[a]=0;c>w[n-1]&&(w[n-1]=c)}}for(h=0;2>h;h++)l[h]+=w[h]}q=l[0]+l[1];h=k[1]+k[2];(l[0]||l[1])&&(q>h||q==h&&l[0]>=k[1]&&l[0]!=k[1]&&l[1]!=k[2])&&(!e[a]||1024<=l[1])&&(k=[a,l[0],l[1]])}1024>k[2]&&x(k[0],1);(256<=k[1]||1024<=k[2])&&"function"==typeof m.s.endgame?m.s.endgame.apply(null,[1024>k[2]]):v=!0}),g,z;for(g=0;g<b*b;g++)e[g]=0,g%b||(z=f("<tr>").appendTo(y)),f("<td>").appendTo(z);y.appendTo(m.b);u=f("td",m.b);m.s.ai_first||null===m.s.ai_first&&1==Math.round(Math.random())?(m.s.ai_first=1,x(Math.floor(b/2)*(1+b),1)):m.s.ai_first=2;v=!0})()}})(jQuery);