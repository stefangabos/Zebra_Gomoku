(function(f){f.gomoku=function(A,B){var C={board_size:15,ai_first:null,endgame:null},h=this,e=[],b,u,v=!1,x=function(b,g){e[b]=g;f(u[b]).addClass("p"+Math.abs(g-h.s.ai_first))};(function(){h.s=f.extend({},C,B);h.board=A;b=h.s.board_size;var y=f('<table id="zebraGomoku">').on("click","td",function(){if(!v||e[u.index(this)])return!1;x(u.index(this),2);var a,p,m,c,q,d,k,l,g,f,t,n,r,w;v=!1;for(a=b*b;a--;)if(1!=e[a]){e[a]||void 0!==n||(n=[a,0,0]);r=[0,0];for(p=4;p--;){w=[0,0];for(m=e[a]?1:5;m--;){k=e[a]||void 0;l=[];for(c=7;c--;)if(q=-5+m+c,!((0===p&&!1!==(d=a+b*q)&&a%b==d%b||1==p&&!1!==(d=a+q)&&~~(d/b)==~~(a/b)||2==p&&!1!==(d=a-b*q+q)&&(d>a&&d%b<a%b||d<a&&d%b>a%b||d==a)||3==p&&!1!==(d=a+b*q+q)&&(d<a&&d%b<a%b||d>a&&d%b>a%b)||d==a)&&0<=d&&d<b*b)||e[d]!=k&&(e[a]||e[d]&&void 0!==k)&&c&&6!=c)if(c&&6!=c)break;else l.push(void 0);else l.push(d),c&&c^6&&void 0===k&&e[d]&&(k=e[d]);if(7==l.length&&void 0!==k){q=e[a]?!0:!1;e[a]=k;t=g=f=0;for(c=5;c--;)e[l[c+1]]==k&&g++;for(c=l.indexOf(a)-1;0<=c;c--)if(e[l[c]]==k)f++;else{0===e[l[c]]&&t++;break}for(c=l.indexOf(a);c<l.length;c++)if(e[l[c]]==k)f++;else{0===e[l[c]]&&t++;break}c=[[0,1],[2,3],[4,12],[10,64],[256,256]][f>=g?Math.min(f,5)-1:g-1][f>=g?t?t-1:0:0];q?256<=c&&(c=1024):e[a]=0;c>w[k-1]&&(w[k-1]=c)}}for(m=2;m--;)r[m]+=w[m]}p=r[0]+r[1];m=n[1]+n[2];(p>m||p==m&&r[0]>=n[1])&&(!e[a]||1024<=r[1])&&(n=[a,r[0],r[1]])}1024>n[2]&&x(n[0],1);(256<=n[1]||1024<=n[2])&&"function"==typeof h.s.endgame?h.s.endgame.apply(null,[1024>n[2]]):v=!0}),g,z;for(g=0;g<b*b;g++)e[g]=0,g%b||(z=f("<tr>").appendTo(y)),z.append(f("<td>"));h.board.append(y);u=f("td",h.board);h.s.ai_first||null===h.s.ai_first&&Math.random()+.5|0?(h.s.ai_first=1,x(~~(b/2)*(1+b),1)):h.s.ai_first=2;v=!0})()}})(jQuery);